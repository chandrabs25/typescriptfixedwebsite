var G=Object.defineProperty;var J=Object.getOwnPropertyDescriptor;var Q=Object.getOwnPropertyNames;var V=Object.prototype.hasOwnProperty;var ee=(c,d)=>()=>(c&&(d=c(c=0)),d);var X=(c,d,S,l)=>{if(d&&typeof d=="object"||typeof d=="function")for(let x of Q(d))!V.call(c,x)&&x!==S&&G(c,x,{get:()=>d[x],enumerable:!(l=J(d,x))||l.enumerable});return c},W=(c,d,S)=>(X(c,d,"default"),S&&X(S,d,"default"));var te=c=>X(G({},"__esModule",{value:!0}),c);var M={};import*as ft from"async_hooks";var Y=ee(()=>{W(M,ft)});import{__getNamedExports as ne}from"../../../__next-on-pages-dist__/webpack/7528.js";import{__getNamedExports as ae}from"../../../__next-on-pages-dist__/webpack/1d2470119d4f846d0a077893f2422c32.js";import{__getNamedExports as _e}from"../../../__next-on-pages-dist__/webpack/ac7e0cd817c0f96ac6506045b651299a.js";import{__getNamedExports as re}from"../../../__next-on-pages-dist__/webpack/841752b73933acd57f0d034e25bbec96.js";import{__getNamedExports as oe}from"../../../__next-on-pages-dist__/manifest/537259e2ed205f5a7994cb4f05664668.js";var p=globalThis.__nextOnPagesRoutesIsolation.getProxyFor("/api/availability"),se=ne(p,p,p),ce=se.__chunk_7528,Z=ae(p,p,p),ie=Z.__chunk_9985,ue=Z.__chunk_4155,n=_e(p,p,p),de=n.__chunk_6195,ge=n.__chunk_2067,pe=n.__chunk_9182,he=n.__chunk_8983,ke=n.__chunk_5228,le=n.__chunk_2296,xe=n.__chunk_2594,me=n.__chunk_6735,fe=n.__chunk_8219,be=n.__chunk_5577,ve=n.__chunk_9254,ye=n.__chunk_9206,Ee=n.__chunk_989,$e=n.__chunk_1863,Re=n.__chunk_3039,Ne=n.__chunk_335,Pe=n.__chunk_8042,we=n.__chunk_7765,Oe=n.__chunk_6991,je=n.__chunk_8816,Ie=n.__chunk_6631,Ae=n.__chunk_4828,Te=n.__chunk_4834,Ce=n.__chunk_828,Fe=n.__chunk_5927,Se=n.__chunk_8439,Ke=n.__chunk_4363,Me=n.__chunk_2039,De=n.__chunk_8264,Le=n.__chunk_1583,Ue=n.__chunk_7908,qe=n.__chunk_8949,Be=n.__chunk_796,He=n.__chunk_1651,Xe=n.__chunk_5105,We=n.__chunk_9642,Ge=n.__chunk_5028,Ye=n.__chunk_9548,Ze=n.__chunk_6914,ze=n.__chunk_7960,Je=n.__chunk_4337,Qe=n.__chunk_8819,h=re(p,p,p),Ve=h.__chunk_1730,et=h.__chunk_3818,tt=h.__chunk_7037,nt=h.__chunk_9573,at=h.__chunk_7701,_t=h.__chunk_662,rt=h.__chunk_4101,ot=h.__chunk_6776,st=h.__chunk_3665,ct=h.__chunk_7444,it=h.__chunk_4591,ut=h.__chunk_7983,dt=h.__chunk_5234,gt=h.__chunk_2561,pt=h.__chunk_2988,ht=h.__chunk_5996,kt=h.__chunk_676,z=oe(p,p,p),lt=z.__NEXT_FONT_MANIFEST,xt=z.__REACT_LOADABLE_MANIFEST,Rt=((c,d,S)=>(d._ENTRIES={},c.__BUILD_MANIFEST={polyfillFiles:["static/chunks/polyfills-42372ed130431b0a.js"],devFiles:[],ampDevFiles:[],lowPriorityFiles:[],rootMainFiles:["static/chunks/webpack-dedf763cc1ab7e12.js","static/chunks/fd9d1056-c9ed5066b0595dc4.js","static/chunks/30-d61876bacc5f7fe8.js","static/chunks/main-app-7952d10a904833a3.js"],pages:{"/_app":["static/chunks/webpack-dedf763cc1ab7e12.js","static/chunks/framework-f66176bb897dc684.js","static/chunks/main-bc32f17986994602.js","static/chunks/pages/_app-72b849fbd24ac258.js"],"/_error":["static/chunks/webpack-dedf763cc1ab7e12.js","static/chunks/framework-f66176bb897dc684.js","static/chunks/main-bc32f17986994602.js","static/chunks/pages/_error-7ba65e1336b92748.js"]},ampFirstPages:[]},c.__BUILD_MANIFEST.lowPriorityFiles=["/static/8V3TQEJtcpB3zmG4GiWhE/_buildManifest.js",,"/static/8V3TQEJtcpB3zmG4GiWhE/_ssgManifest.js"],c.__REACT_LOADABLE_MANIFEST=xt,c.__NEXT_FONT_MANIFEST=lt,c.__INTERCEPTION_ROUTE_REWRITE_MANIFEST="[]",(()=>{"use strict";var l={},x={};function r(t){var i=x[t];if(i!==void 0)return i.exports;var s=x[t]={exports:{}},m=!0;try{l[t](s,s.exports,r),m=!1}finally{m&&delete x[t]}return s.exports}r.m=l,r.amdO={},(()=>{var t=[];r.O=(i,s,m,f)=>{if(s){f=f||0;for(var g=t.length;g>0&&t[g-1][2]>f;g--)t[g]=t[g-1];t[g]=[s,m,f];return}for(var u=1/0,g=0;g<t.length;g++){for(var[s,m,f]=t[g],P=!0,E=0;E<s.length;E++)u>=f&&Object.keys(r.O).every(F=>r.O[F](s[E]))?s.splice(E--,1):(P=!1,f<u&&(u=f));if(P){t.splice(g--,1);var j=m();j!==void 0&&(i=j)}}return i}})(),r.n=t=>{var i=t&&t.__esModule?()=>t.default:()=>t;return r.d(i,{a:i}),i},r.d=(t,i)=>{for(var s in i)r.o(i,s)&&!r.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:i[s]})},r.e=()=>Promise.resolve(),r.g=function(){if(typeof d=="object")return d;try{return this||Function("return this")()}catch{if(typeof window=="object")return window}}(),r.o=(t,i)=>Object.prototype.hasOwnProperty.call(t,i),r.r=t=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t={993:0};r.O.j=m=>t[m]===0;var i=(m,f)=>{var g,u,[P,E,j]=f,I=0;if(P.some(T=>t[T]!==0)){for(g in E)r.o(E,g)&&(r.m[g]=E[g]);if(j)var K=j(r)}for(m&&m(f);I<P.length;I++)u=P[I],r.o(t,u)&&t[u]&&t[u][0](),t[u]=0;return r.O(K)},s=c.webpackChunk_N_E=c.webpackChunk_N_E||[];s.forEach(i.bind(null,0)),s.push=i.bind(null,s.push.bind(s))})()})(),(c.webpackChunk_N_E=c.webpackChunk_N_E||[]).push([[720],{8819:Qe,4337:Je,7960:ze,6914:Ze,9548:Ye,5028:Ge,9642:We,5105:Xe,1651:He,796:Be,8949:qe,7908:Ue,1583:Le,8264:De,2039:Me,4363:Ke,8439:Se,5927:Fe,828:Ce,4834:Te,4828:Ae,6631:Ie,8816:je,6991:Oe,7765:we,8042:Pe,335:Ne,3039:Re,1863:$e,989:Ee,9206:ye,9254:ve,5577:be,8219:fe,6735:me,2594:xe,2296:le,5228:ke,8983:he,9182:pe}]),(c.webpackChunk_N_E=c.webpackChunk_N_E||[]).push([[883],{676:kt,5996:ht,2988:pt,2561:gt,5234:dt,7983:ut,4591:it,7444:ct,3665:st,6776:ot,4101:rt,662:_t,7701:at,9573:nt,7037:tt,3818:et,1730:Ve}]),(c.webpackChunk_N_E=c.webpackChunk_N_E||[]).push([[325],{2067:ge,6195:de,2358:(l,x,r)=>{"use strict";r.r(x),r.d(x,{ComponentMod:()=>q,default:()=>B});var t={};r.r(t),r.d(t,{GET:()=>j,runtime:()=>E});var i={};r.r(i),r.d(i,{originalPathname:()=>F,patchFetch:()=>U,requestAsyncStorage:()=>K,routeModule:()=>I,serverHooks:()=>C,staticGenerationAsyncStorage:()=>T});var s=r(7983),m=r(2561),f=r(4828),g=r(6631),u=r(9985),P=r(7528);let E="edge";async function j(H){let D=(0,P.N)();try{let O=H.nextUrl.searchParams,$=O.get("packageId"),A=O.get("startDate"),b=O.get("endDate"),e=O.get("guests");if(!$||!A||!b||!e)return u.xk.json({available:!1,message:"Missing required parameters: packageId, startDate, endDate, guests"},{status:400});let o=parseInt($,10),a=parseInt(e,10);if(isNaN(o)||o<=0||isNaN(a)||a<=0)return u.xk.json({available:!1,message:"Invalid packageId or guests parameter. Must be positive numbers."},{status:400});let _=/^\d{4}-\d{2}-\d{2}$/;if(!_.test(A)||!_.test(b))return u.xk.json({available:!1,message:"Invalid date format. Use YYYY-MM-DD."},{status:400});let R=new Date(A+"T00:00:00Z"),k=new Date(b+"T00:00:00Z");if(isNaN(R.getTime())||isNaN(k.getTime()))return u.xk.json({available:!1,message:"Invalid date value(s)."},{status:400});if(R>=k)return u.xk.json({available:!1,message:"End date must be strictly after start date."},{status:400});let v=await D.prepare("SELECT id, base_price, max_people FROM packages WHERE id = ? AND is_active = 1").bind(o).first();if(!v)return u.xk.json({available:!1,message:`Package with ID ${o} not found or is inactive.`},{status:404});if(v.max_people!==null&&a>v.max_people)return u.xk.json({available:!1,message:`Maximum ${v.max_people} guests allowed for this package.`},{status:200});let N=await D.prepare(`
      SELECT id FROM bookings
      WHERE package_id = ?
        AND status IN ('pending', 'confirmed')
        AND start_date < ?
        AND end_date > ?
    `).bind(o,b,A).all();if(!N.success)throw console.error("Failed to query overlapping bookings:",N.error),Error("Database error checking booking conflicts.");if(N.results&&N.results.length>0)return console.log(`Availability check failed for package ${o} (${A} to ${b}): Overlapping bookings found.`),u.xk.json({available:!1,message:"This package is already booked for the selected dates or part of the range."},{status:200});let y=v.base_price*a,w=.18*y,L={available:!0,message:"The selected package is available for booking.",packageId:$,startDate:A,endDate:b,guests:a,pricing:{basePrice:parseFloat(y.toFixed(2)),taxes:parseFloat(w.toFixed(2)),totalAmount:parseFloat((y+w).toFixed(2))}};return u.xk.json(L,{status:200})}catch(O){console.error("Error checking availability:",O);let $={available:!1,message:"Failed to check availability due to an internal server error.",error:O instanceof Error?O.message:"Unknown error"};return u.xk.json($,{status:500})}}let I=new m.AppRouteRouteModule({definition:{kind:f.x.APP_ROUTE,page:"/api/availability/route",pathname:"/api/availability",filename:"route",bundlePath:"app/api/availability/route"},resolvedPagePath:"/home/chandra/andaman_website_CLI/andaman website CLI/src/app/api/availability/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:K,staticGenerationAsyncStorage:T,serverHooks:C}=I,F="/api/availability/route";function U(){return(0,g.XH)({serverHooks:C,staticGenerationAsyncStorage:T})}let q=i,B=s.a.wrap(I)},4155:ue,9985:ie,7528:ce},l=>{var x=t=>l(l.s=t);l.O(0,[720,883],()=>x(2358));var r=l.O();(d._ENTRIES=typeof d._ENTRIES>"u"?{}:d._ENTRIES)["middleware_app/api/availability/route"]=r}]),function(){let l={exports:{},loaded:!1};return function(r,t){var i=Object.create,s=Object.defineProperty,m=Object.getOwnPropertyDescriptor,f=Object.getOwnPropertyNames,g=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty,P=e=>s(e,"__esModule",{value:!0}),E=(e,o)=>{P(e);for(var a in o)s(e,a,{get:o[a],enumerable:!0})},j=(e,o,a)=>{if(o&&typeof o=="object"||typeof o=="function")for(let _ of f(o))!u.call(e,_)&&_!=="default"&&s(e,_,{get:()=>o[_],enumerable:!(a=m(o,_))||a.enumerable});return e},I=e=>j(P(s(e!=null?i(g(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);E(t,{default:()=>O});var K=I((Y(),te(M))),T="@next/request-context",C=Symbol.for(T),F=Symbol.for("internal.storage");function U(){let e=d;if(!e[C]){let o=new K.AsyncLocalStorage,a={get:()=>o.getStore(),[F]:o};e[C]=a}return e[C]}var q=U();function B(e,o){return q[F].run(e,o)}function H(e){let o={};return e&&e.forEach((a,_)=>{o[_]=a,_.toLowerCase()==="set-cookie"&&(o[_]=D(a))}),o}function D(e){let o=[],a=0,_,R,k,v,N;function y(){for(;a<e.length&&/\s/.test(e.charAt(a));)a+=1;return a<e.length}function w(){return R=e.charAt(a),R!=="="&&R!==";"&&R!==","}for(;a<e.length;){for(_=a,N=!1;y();)if(R=e.charAt(a),R===","){for(k=a,a+=1,y(),v=a;a<e.length&&w();)a+=1;a<e.length&&e.charAt(a)==="="?(N=!0,a=v,o.push(e.substring(_,k)),_=a):a=k+1}else a+=1;(!N||a>=e.length)&&o.push(e.substring(_,e.length))}return o}function O(e){let o=e.staticRoutes.map(_=>({regexp:new RegExp(_.namedRegex),page:_.page})),a=e.dynamicRoutes?.map(_=>({regexp:new RegExp(_.namedRegex),page:_.page}))||[];return async function(_,R){let k=new URL(_.url).pathname,v={};if(e.nextConfig?.basePath&&k.startsWith(e.nextConfig.basePath)&&(k=k.replace(e.nextConfig.basePath,"")||"/"),e.nextConfig?.i18n)for(let y of e.nextConfig.i18n.locales){let w=new RegExp(`^/${y}($|/)`,"i");if(k.match(w)){k=k.replace(w,"/")||"/";break}}for(let y of o)if(y.regexp.exec(k)){v.name=y.page;break}if(!v.name){let y=A(k);for(let w of a||[]){if(y&&!A(w.page))continue;let L=w.regexp.exec(k);if(L){v={name:w.page,params:L.groups};break}}}let N=await B({waitUntil:R.waitUntil},()=>d._ENTRIES[`middleware_${e.name}`].default.call({},{request:{url:_.url,method:_.method,headers:H(_.headers),ip:$(_.headers,b.Ip),geo:{city:$(_.headers,b.City,!0),country:$(_.headers,b.Country,!0),latitude:$(_.headers,b.Latitude),longitude:$(_.headers,b.Longitude),region:$(_.headers,b.Region,!0)},nextConfig:e.nextConfig,page:v,body:_.body}}));return N.waitUntil&&R.waitUntil(N.waitUntil),N.response}}function $(e,o,a=!1){let _=e.get(o)||void 0;return a&&_?decodeURIComponent(_):_}function A(e){return e==="/api"||e.startsWith("/api/")}var b;(function(e){e.City="x-vercel-ip-city",e.Country="x-vercel-ip-country",e.Ip="x-real-ip",e.Latitude="x-vercel-ip-latitude",e.Longitude="x-vercel-ip-longitude",e.Region="x-vercel-ip-country-region"})(b||(b={}))}(l,l.exports),l.exports}.call({}).default({name:"app/api/availability/route",staticRoutes:[{page:"/",regex:"^/(?:/)?$",routeKeys:{},namedRegex:"^/(?:/)?$"},{page:"/_not-found",regex:"^/_not\\-found(?:/)?$",routeKeys:{},namedRegex:"^/_not\\-found(?:/)?$"},{page:"/about",regex:"^/about(?:/)?$",routeKeys:{},namedRegex:"^/about(?:/)?$"},{page:"/activities",regex:"^/activities(?:/)?$",routeKeys:{},namedRegex:"^/activities(?:/)?$"},{page:"/auth/signin",regex:"^/auth/signin(?:/)?$",routeKeys:{},namedRegex:"^/auth/signin(?:/)?$"},{page:"/auth/signup",regex:"^/auth/signup(?:/)?$",routeKeys:{},namedRegex:"^/auth/signup(?:/)?$"},{page:"/contact",regex:"^/contact(?:/)?$",routeKeys:{},namedRegex:"^/contact(?:/)?$"},{page:"/destinations",regex:"^/destinations(?:/)?$",routeKeys:{},namedRegex:"^/destinations(?:/)?$"},{page:"/favicon.ico",regex:"^/favicon\\.ico(?:/)?$",routeKeys:{},namedRegex:"^/favicon\\.ico(?:/)?$"},{page:"/packages",regex:"^/packages(?:/)?$",routeKeys:{},namedRegex:"^/packages(?:/)?$"},{page:"/search",regex:"^/search(?:/)?$",routeKeys:{},namedRegex:"^/search(?:/)?$"},{page:"/search-results",regex:"^/search\\-results(?:/)?$",routeKeys:{},namedRegex:"^/search\\-results(?:/)?$"},{page:"/user/bookings",regex:"^/user/bookings(?:/)?$",routeKeys:{},namedRegex:"^/user/bookings(?:/)?$"},{page:"/user/dashboard",regex:"^/user/dashboard(?:/)?$",routeKeys:{},namedRegex:"^/user/dashboard(?:/)?$"},{page:"/vendor/bookings",regex:"^/vendor/bookings(?:/)?$",routeKeys:{},namedRegex:"^/vendor/bookings(?:/)?$"},{page:"/vendor/dashboard",regex:"^/vendor/dashboard(?:/)?$",routeKeys:{},namedRegex:"^/vendor/dashboard(?:/)?$"},{page:"/vendor/login",regex:"^/vendor/login(?:/)?$",routeKeys:{},namedRegex:"^/vendor/login(?:/)?$"},{page:"/vendor/register",regex:"^/vendor/register(?:/)?$",routeKeys:{},namedRegex:"^/vendor/register(?:/)?$"},{page:"/vendor/services",regex:"^/vendor/services(?:/)?$",routeKeys:{},namedRegex:"^/vendor/services(?:/)?$"},{page:"/vendors",regex:"^/vendors(?:/)?$",routeKeys:{},namedRegex:"^/vendors(?:/)?$"}],dynamicRoutes:[{page:"/api/auth/[...nextauth]",regex:"^/api/auth/(.+?)(?:/)?$",routeKeys:{nxtPnextauth:"nxtPnextauth"},namedRegex:"^/api/auth/(?<nxtPnextauth>.+?)(?:/)?$"},{page:"/api/bookings/[id]",regex:"^/api/bookings/([^/]+?)(?:/)?$",routeKeys:{nxtPid:"nxtPid"},namedRegex:"^/api/bookings/(?<nxtPid>[^/]+?)(?:/)?$"},{page:"/api/destinations/[id]",regex:"^/api/destinations/([^/]+?)(?:/)?$",routeKeys:{nxtPid:"nxtPid"},namedRegex:"^/api/destinations/(?<nxtPid>[^/]+?)(?:/)?$"},{page:"/api/packages/[id]",regex:"^/api/packages/([^/]+?)(?:/)?$",routeKeys:{nxtPid:"nxtPid"},namedRegex:"^/api/packages/(?<nxtPid>[^/]+?)(?:/)?$"},{page:"/api/vendors/[id]",regex:"^/api/vendors/([^/]+?)(?:/)?$",routeKeys:{nxtPid:"nxtPid"},namedRegex:"^/api/vendors/(?<nxtPid>[^/]+?)(?:/)?$"},{page:"/bookings/confirmation/[id]",regex:"^/bookings/confirmation/([^/]+?)(?:/)?$",routeKeys:{nxtPid:"nxtPid"},namedRegex:"^/bookings/confirmation/(?<nxtPid>[^/]+?)(?:/)?$"},{page:"/bookings/payment/[id]",regex:"^/bookings/payment/([^/]+?)(?:/)?$",routeKeys:{nxtPid:"nxtPid"},namedRegex:"^/bookings/payment/(?<nxtPid>[^/]+?)(?:/)?$"},{page:"/destinations/[id]",regex:"^/destinations/([^/]+?)(?:/)?$",routeKeys:{nxtPid:"nxtPid"},namedRegex:"^/destinations/(?<nxtPid>[^/]+?)(?:/)?$"},{page:"/packages/[id]",regex:"^/packages/([^/]+?)(?:/)?$",routeKeys:{nxtPid:"nxtPid"},namedRegex:"^/packages/(?<nxtPid>[^/]+?)(?:/)?$"},{page:"/packages/[id]/book",regex:"^/packages/([^/]+?)/book(?:/)?$",routeKeys:{nxtPid:"nxtPid"},namedRegex:"^/packages/(?<nxtPid>[^/]+?)/book(?:/)?$"}],nextConfig:{basePath:""}})))(p,p,p);export{Rt as default};

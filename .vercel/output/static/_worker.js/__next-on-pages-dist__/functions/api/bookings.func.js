var Y=Object.defineProperty;var Z=Object.getOwnPropertyDescriptor;var ee=Object.getOwnPropertyNames;var ne=Object.prototype.hasOwnProperty;var te=(r,g)=>()=>(r&&(g=r(r=0)),g);var X=(r,g,M,m)=>{if(g&&typeof g=="object"||typeof g=="function")for(let f of ee(g))!ne.call(r,f)&&f!==M&&Y(r,f,{get:()=>g[f],enumerable:!(m=Z(g,f))||m.enumerable});return r},W=(r,g,M)=>(X(r,g,"default"),M&&X(M,g,"default"));var _e=r=>X(Y({},"__esModule",{value:!0}),r);var D={};import*as qn from"async_hooks";var z=te(()=>{W(D,qn)});import{__getNamedExports as oe}from"../../../__next-on-pages-dist__/webpack/7528.js";import{__getNamedExports as se}from"../../../__next-on-pages-dist__/webpack/d7a3494d4c6574a4ef4f5f60c456df00.js";import{__getNamedExports as ae}from"../../../__next-on-pages-dist__/webpack/ac7e0cd817c0f96ac6506045b651299a.js";import{__getNamedExports as re}from"../../../__next-on-pages-dist__/webpack/1d2470119d4f846d0a077893f2422c32.js";import{__getNamedExports as ce}from"../../../__next-on-pages-dist__/webpack/841752b73933acd57f0d034e25bbec96.js";import{__getNamedExports as ue}from"../../../__next-on-pages-dist__/manifest/537259e2ed205f5a7994cb4f05664668.js";var h=globalThis.__nextOnPagesRoutesIsolation.getProxyFor("/api/bookings"),ie=oe(h,h,h),ge=ie.__chunk_7528,p=se(h,h,h),he=p.__chunk_230,ke=p.__chunk_219,de=p.__chunk_7269,pe=p.__chunk_8312,le=p.__chunk_2967,xe=p.__chunk_6178,me=p.__chunk_7511,fe=p.__chunk_212,be=p.__chunk_8713,Ee=p.__chunk_4181,ye=p.__chunk_7190,ve=p.__chunk_2265,Re=p.__chunk_7393,$e=p.__chunk_8540,Ne=p.__chunk_3932,Pe=p.__chunk_7391,we=p.__chunk_7442,Oe=p.__chunk_5763,je=p.__chunk_6753,o=ae(h,h,h),Ae=o.__chunk_6195,Ie=o.__chunk_2067,Se=o.__chunk_9182,Te=o.__chunk_8983,Ce=o.__chunk_5228,Ke=o.__chunk_2296,Me=o.__chunk_2594,Fe=o.__chunk_6735,Le=o.__chunk_8219,De=o.__chunk_5577,Ue=o.__chunk_9254,qe=o.__chunk_9206,Be=o.__chunk_989,Ge=o.__chunk_1863,He=o.__chunk_3039,Xe=o.__chunk_335,We=o.__chunk_8042,Ve=o.__chunk_7765,Ye=o.__chunk_6991,ze=o.__chunk_8816,Je=o.__chunk_6631,Qe=o.__chunk_4828,Ze=o.__chunk_4834,en=o.__chunk_828,nn=o.__chunk_5927,tn=o.__chunk_8439,_n=o.__chunk_4363,on=o.__chunk_2039,sn=o.__chunk_8264,an=o.__chunk_1583,rn=o.__chunk_7908,cn=o.__chunk_8949,un=o.__chunk_796,gn=o.__chunk_1651,hn=o.__chunk_5105,kn=o.__chunk_9642,dn=o.__chunk_5028,pn=o.__chunk_9548,ln=o.__chunk_6914,xn=o.__chunk_7960,mn=o.__chunk_4337,fn=o.__chunk_8819,J=re(h,h,h),bn=J.__chunk_9985,En=J.__chunk_4155,x=ce(h,h,h),yn=x.__chunk_1730,vn=x.__chunk_3818,Rn=x.__chunk_7037,$n=x.__chunk_9573,Nn=x.__chunk_7701,Pn=x.__chunk_662,wn=x.__chunk_4101,On=x.__chunk_6776,jn=x.__chunk_3665,An=x.__chunk_7444,In=x.__chunk_4591,Sn=x.__chunk_7983,Tn=x.__chunk_5234,Cn=x.__chunk_2561,Kn=x.__chunk_2988,Mn=x.__chunk_5996,Fn=x.__chunk_676,Q=ue(h,h,h),Ln=Q.__NEXT_FONT_MANIFEST,Dn=Q.__REACT_LOADABLE_MANIFEST,Yn=((r,g,M)=>(g._ENTRIES={},r.__BUILD_MANIFEST={polyfillFiles:["static/chunks/polyfills-42372ed130431b0a.js"],devFiles:[],ampDevFiles:[],lowPriorityFiles:[],rootMainFiles:["static/chunks/webpack-dedf763cc1ab7e12.js","static/chunks/fd9d1056-c9ed5066b0595dc4.js","static/chunks/30-d61876bacc5f7fe8.js","static/chunks/main-app-7952d10a904833a3.js"],pages:{"/_app":["static/chunks/webpack-dedf763cc1ab7e12.js","static/chunks/framework-f66176bb897dc684.js","static/chunks/main-bc32f17986994602.js","static/chunks/pages/_app-72b849fbd24ac258.js"],"/_error":["static/chunks/webpack-dedf763cc1ab7e12.js","static/chunks/framework-f66176bb897dc684.js","static/chunks/main-bc32f17986994602.js","static/chunks/pages/_error-7ba65e1336b92748.js"]},ampFirstPages:[]},r.__BUILD_MANIFEST.lowPriorityFiles=["/static/8V3TQEJtcpB3zmG4GiWhE/_buildManifest.js",,"/static/8V3TQEJtcpB3zmG4GiWhE/_ssgManifest.js"],r.__REACT_LOADABLE_MANIFEST=Dn,r.__NEXT_FONT_MANIFEST=Ln,r.__INTERCEPTION_ROUTE_REWRITE_MANIFEST="[]",(()=>{"use strict";var m={},f={};function s(t){var u=f[t];if(u!==void 0)return u.exports;var c=f[t]={exports:{}},b=!0;try{m[t](c,c.exports,s),b=!1}finally{b&&delete f[t]}return c.exports}s.m=m,s.amdO={},(()=>{var t=[];s.O=(u,c,b,E)=>{if(c){E=E||0;for(var k=t.length;k>0&&t[k-1][2]>E;k--)t[k]=t[k-1];t[k]=[c,b,E];return}for(var d=1/0,k=0;k<t.length;k++){for(var[c,b,E]=t[k],$=!0,R=0;R<c.length;R++)d>=E&&Object.keys(s.O).every(C=>s.O[C](c[R]))?c.splice(R--,1):($=!1,E<d&&(d=E));if($){t.splice(k--,1);var A=b();A!==void 0&&(u=A)}}return u}})(),s.n=t=>{var u=t&&t.__esModule?()=>t.default:()=>t;return s.d(u,{a:u}),u},s.d=(t,u)=>{for(var c in u)s.o(u,c)&&!s.o(t,c)&&Object.defineProperty(t,c,{enumerable:!0,get:u[c]})},s.e=()=>Promise.resolve(),s.g=function(){if(typeof g=="object")return g;try{return this||Function("return this")()}catch{if(typeof window=="object")return window}}(),s.o=(t,u)=>Object.prototype.hasOwnProperty.call(t,u),s.r=t=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t={993:0};s.O.j=b=>t[b]===0;var u=(b,E)=>{var k,d,[$,R,A]=E,S=0;if($.some(T=>t[T]!==0)){for(k in R)s.o(R,k)&&(s.m[k]=R[k]);if(A)var F=A(s)}for(b&&b(E);S<$.length;S++)d=$[S],s.o(t,d)&&t[d]&&t[d][0](),t[d]=0;return s.O(F)},c=r.webpackChunk_N_E=r.webpackChunk_N_E||[];c.forEach(u.bind(null,0)),c.push=u.bind(null,c.push.bind(c))})()})(),(r.webpackChunk_N_E=r.webpackChunk_N_E||[]).push([[720],{8819:fn,4337:mn,7960:xn,6914:ln,9548:pn,5028:dn,9642:kn,5105:hn,1651:gn,796:un,8949:cn,7908:rn,1583:an,8264:sn,2039:on,4363:_n,8439:tn,5927:nn,828:en,4834:Ze,4828:Qe,6631:Je,8816:ze,6991:Ye,7765:Ve,8042:We,335:Xe,3039:He,1863:Ge,989:Be,9206:qe,9254:Ue,5577:De,8219:Le,6735:Fe,2594:Me,2296:Ke,5228:Ce,8983:Te,9182:Se}]),(r.webpackChunk_N_E=r.webpackChunk_N_E||[]).push([[883],{676:Fn,5996:Mn,2988:Kn,2561:Cn,5234:Tn,7983:Sn,4591:In,7444:An,3665:jn,6776:On,4101:wn,662:Pn,7701:Nn,9573:$n,7037:Rn,3818:vn,1730:yn}]),(r.webpackChunk_N_E=r.webpackChunk_N_E||[]).push([[406],{4155:En,9985:bn,6753:je,5763:Oe,7442:we,7391:Pe,3932:Ne,8540:$e,7393:Re,2265:ve,7190:ye,4181:Ee,8713:be,212:fe,7511:me,6178:xe,2967:le,8312:pe,7269:de,219:ke}]),(r.webpackChunk_N_E=r.webpackChunk_N_E||[]).push([[946],{2067:Ie,6195:Ae,9661:(m,f,s)=>{"use strict";s.r(f),s.d(f,{ComponentMod:()=>G,default:()=>H});var t={};s.r(t),s.d(t,{GET:()=>S,POST:()=>F,runtime:()=>A});var u={};s.r(u),s.d(u,{originalPathname:()=>q,patchFetch:()=>B,requestAsyncStorage:()=>L,routeModule:()=>T,serverHooks:()=>U,staticGenerationAsyncStorage:()=>C});var c=s(7983),b=s(2561),E=s(4828),k=s(6631),d=s(9985),$=s(7528),R=s(230);let A="edge";async function S(K){let y=await(0,R.RA)(K);if(!y.isAuthenticated||!y.user)return d.xk.json({success:!1,message:"Authentication required to view bookings."},{status:401});let I=parseInt(y.user.id,10);try{let i=(0,$.N)(),{searchParams:e}=new URL(K.url),a=e.get("status"),_="SELECT * FROM bookings WHERE user_id = ?",n=[I];a&&(_+=" AND status = ?",n.push(a)),_+=" ORDER BY start_date DESC";let{results:v,success:l,error:w}=await i.prepare(_).bind(...n).all();if(!l)throw console.error("Failed to fetch user bookings:",w),Error("Database query failed");return d.xk.json({success:!0,bookings:v||[]},{status:200})}catch(i){return console.error("Error fetching bookings:",i),d.xk.json({message:"Failed to fetch bookings",error:i instanceof Error?i.message:"Unknown error"},{status:500})}}async function F(K){let y=null,I=null;try{let i=await(0,R.RA)(K);i.isAuthenticated&&i.user?(y=parseInt(i.user.id,10),I=i.user.email,console.log(`Authenticated user booking request. User ID: ${y}`)):console.log("Guest booking request.");let e=await K.json(),a=["packageId","startDate","endDate","guests","amount"].filter(j=>!(j in e)||e[j]===void 0||e[j]===null||e[j]==="");if(a.length>0)return d.xk.json({message:`Missing required booking details: ${a.join(", ")}`},{status:400});let _=null,n=null,v=null;if(!y){let j=["guestName","guestEmail","guestPhone"].filter(V=>!(V in e)||!e[V]);if(j.length>0)return d.xk.json({message:`Guest details required for booking without an account: ${j.join(", ")}`},{status:400});if(!/\S+@\S+\.\S+/.test(e.guestEmail))return d.xk.json({message:"Invalid guest email format."},{status:400});_=e.guestName,n=e.guestEmail,v=e.guestPhone,I=n}let l=(0,$.N)(),w=l.prepare(`
      INSERT INTO bookings (
        user_id, package_id, total_people, start_date, end_date,
        total_amount, status, payment_status, special_requests,
        guest_name, guest_email, guest_phone, created_at, updated_at
      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP)
    `),N=await w.bind(y,e.packageId,e.guests,e.startDate,e.endDate,e.amount,"pending","pending",e.specialRequests||null,_,n,v).run();if(!N.success||!N.meta?.last_row_id)throw console.error("Booking insert failed:",N),Error("Database operation failed to create booking.");let P=N.meta.last_row_id;console.log(`Booking created successfully (ID: ${P}). Need to send confirmation to ${I}`);let O=await l.prepare("SELECT * FROM bookings WHERE id = ?").bind(P).first();return d.xk.json({success:!0,message:"Booking created successfully!",booking:O},{status:201})}catch(i){console.error("Error creating booking:",i);let e=i instanceof Error?i.message:"Unknown error";return d.xk.json({success:!1,message:"Failed to create booking",error:e},{status:500})}}let T=new b.AppRouteRouteModule({definition:{kind:E.x.APP_ROUTE,page:"/api/bookings/route",pathname:"/api/bookings",filename:"route",bundlePath:"app/api/bookings/route"},resolvedPagePath:"/home/chandra/andaman_website_CLI/andaman website CLI/src/app/api/bookings/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:L,staticGenerationAsyncStorage:C,serverHooks:U}=T,q="/api/bookings/route";function B(){return(0,k.XH)({serverHooks:U,staticGenerationAsyncStorage:C})}let G=u,H=c.a.wrap(T)},230:he,7528:ge},m=>{var f=t=>m(m.s=t);m.O(0,[720,883,406],()=>f(9661));var s=m.O();(g._ENTRIES=typeof g._ENTRIES>"u"?{}:g._ENTRIES)["middleware_app/api/bookings/route"]=s}]),function(){let m={exports:{},loaded:!1};return function(s,t){var u=Object.create,c=Object.defineProperty,b=Object.getOwnPropertyDescriptor,E=Object.getOwnPropertyNames,k=Object.getPrototypeOf,d=Object.prototype.hasOwnProperty,$=e=>c(e,"__esModule",{value:!0}),R=(e,a)=>{$(e);for(var _ in a)c(e,_,{get:a[_],enumerable:!0})},A=(e,a,_)=>{if(a&&typeof a=="object"||typeof a=="function")for(let n of E(a))!d.call(e,n)&&n!=="default"&&c(e,n,{get:()=>a[n],enumerable:!(_=b(a,n))||_.enumerable});return e},S=e=>A($(c(e!=null?u(k(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);R(t,{default:()=>K});var F=S((z(),_e(D))),T="@next/request-context",L=Symbol.for(T),C=Symbol.for("internal.storage");function U(){let e=g;if(!e[L]){let a=new F.AsyncLocalStorage,_={get:()=>a.getStore(),[C]:a};e[L]=_}return e[L]}var q=U();function B(e,a){return q[C].run(e,a)}function G(e){let a={};return e&&e.forEach((_,n)=>{a[n]=_,n.toLowerCase()==="set-cookie"&&(a[n]=H(_))}),a}function H(e){let a=[],_=0,n,v,l,w,N;function P(){for(;_<e.length&&/\s/.test(e.charAt(_));)_+=1;return _<e.length}function O(){return v=e.charAt(_),v!=="="&&v!==";"&&v!==","}for(;_<e.length;){for(n=_,N=!1;P();)if(v=e.charAt(_),v===","){for(l=_,_+=1,P(),w=_;_<e.length&&O();)_+=1;_<e.length&&e.charAt(_)==="="?(N=!0,_=w,a.push(e.substring(n,l)),n=_):_=l+1}else _+=1;(!N||_>=e.length)&&a.push(e.substring(n,e.length))}return a}function K(e){let a=e.staticRoutes.map(n=>({regexp:new RegExp(n.namedRegex),page:n.page})),_=e.dynamicRoutes?.map(n=>({regexp:new RegExp(n.namedRegex),page:n.page}))||[];return async function(n,v){let l=new URL(n.url).pathname,w={};if(e.nextConfig?.basePath&&l.startsWith(e.nextConfig.basePath)&&(l=l.replace(e.nextConfig.basePath,"")||"/"),e.nextConfig?.i18n)for(let P of e.nextConfig.i18n.locales){let O=new RegExp(`^/${P}($|/)`,"i");if(l.match(O)){l=l.replace(O,"/")||"/";break}}for(let P of a)if(P.regexp.exec(l)){w.name=P.page;break}if(!w.name){let P=I(l);for(let O of _||[]){if(P&&!I(O.page))continue;let j=O.regexp.exec(l);if(j){w={name:O.page,params:j.groups};break}}}let N=await B({waitUntil:v.waitUntil},()=>g._ENTRIES[`middleware_${e.name}`].default.call({},{request:{url:n.url,method:n.method,headers:G(n.headers),ip:y(n.headers,i.Ip),geo:{city:y(n.headers,i.City,!0),country:y(n.headers,i.Country,!0),latitude:y(n.headers,i.Latitude),longitude:y(n.headers,i.Longitude),region:y(n.headers,i.Region,!0)},nextConfig:e.nextConfig,page:w,body:n.body}}));return N.waitUntil&&v.waitUntil(N.waitUntil),N.response}}function y(e,a,_=!1){let n=e.get(a)||void 0;return _&&n?decodeURIComponent(n):n}function I(e){return e==="/api"||e.startsWith("/api/")}var i;(function(e){e.City="x-vercel-ip-city",e.Country="x-vercel-ip-country",e.Ip="x-real-ip",e.Latitude="x-vercel-ip-latitude",e.Longitude="x-vercel-ip-longitude",e.Region="x-vercel-ip-country-region"})(i||(i={}))}(m,m.exports),m.exports}.call({}).default({name:"app/api/bookings/route",staticRoutes:[{page:"/",regex:"^/(?:/)?$",routeKeys:{},namedRegex:"^/(?:/)?$"},{page:"/_not-found",regex:"^/_not\\-found(?:/)?$",routeKeys:{},namedRegex:"^/_not\\-found(?:/)?$"},{page:"/about",regex:"^/about(?:/)?$",routeKeys:{},namedRegex:"^/about(?:/)?$"},{page:"/activities",regex:"^/activities(?:/)?$",routeKeys:{},namedRegex:"^/activities(?:/)?$"},{page:"/auth/signin",regex:"^/auth/signin(?:/)?$",routeKeys:{},namedRegex:"^/auth/signin(?:/)?$"},{page:"/auth/signup",regex:"^/auth/signup(?:/)?$",routeKeys:{},namedRegex:"^/auth/signup(?:/)?$"},{page:"/contact",regex:"^/contact(?:/)?$",routeKeys:{},namedRegex:"^/contact(?:/)?$"},{page:"/destinations",regex:"^/destinations(?:/)?$",routeKeys:{},namedRegex:"^/destinations(?:/)?$"},{page:"/favicon.ico",regex:"^/favicon\\.ico(?:/)?$",routeKeys:{},namedRegex:"^/favicon\\.ico(?:/)?$"},{page:"/packages",regex:"^/packages(?:/)?$",routeKeys:{},namedRegex:"^/packages(?:/)?$"},{page:"/search",regex:"^/search(?:/)?$",routeKeys:{},namedRegex:"^/search(?:/)?$"},{page:"/search-results",regex:"^/search\\-results(?:/)?$",routeKeys:{},namedRegex:"^/search\\-results(?:/)?$"},{page:"/user/bookings",regex:"^/user/bookings(?:/)?$",routeKeys:{},namedRegex:"^/user/bookings(?:/)?$"},{page:"/user/dashboard",regex:"^/user/dashboard(?:/)?$",routeKeys:{},namedRegex:"^/user/dashboard(?:/)?$"},{page:"/vendor/bookings",regex:"^/vendor/bookings(?:/)?$",routeKeys:{},namedRegex:"^/vendor/bookings(?:/)?$"},{page:"/vendor/dashboard",regex:"^/vendor/dashboard(?:/)?$",routeKeys:{},namedRegex:"^/vendor/dashboard(?:/)?$"},{page:"/vendor/login",regex:"^/vendor/login(?:/)?$",routeKeys:{},namedRegex:"^/vendor/login(?:/)?$"},{page:"/vendor/register",regex:"^/vendor/register(?:/)?$",routeKeys:{},namedRegex:"^/vendor/register(?:/)?$"},{page:"/vendor/services",regex:"^/vendor/services(?:/)?$",routeKeys:{},namedRegex:"^/vendor/services(?:/)?$"},{page:"/vendors",regex:"^/vendors(?:/)?$",routeKeys:{},namedRegex:"^/vendors(?:/)?$"}],dynamicRoutes:[{page:"/api/auth/[...nextauth]",regex:"^/api/auth/(.+?)(?:/)?$",routeKeys:{nxtPnextauth:"nxtPnextauth"},namedRegex:"^/api/auth/(?<nxtPnextauth>.+?)(?:/)?$"},{page:"/api/bookings/[id]",regex:"^/api/bookings/([^/]+?)(?:/)?$",routeKeys:{nxtPid:"nxtPid"},namedRegex:"^/api/bookings/(?<nxtPid>[^/]+?)(?:/)?$"},{page:"/api/destinations/[id]",regex:"^/api/destinations/([^/]+?)(?:/)?$",routeKeys:{nxtPid:"nxtPid"},namedRegex:"^/api/destinations/(?<nxtPid>[^/]+?)(?:/)?$"},{page:"/api/packages/[id]",regex:"^/api/packages/([^/]+?)(?:/)?$",routeKeys:{nxtPid:"nxtPid"},namedRegex:"^/api/packages/(?<nxtPid>[^/]+?)(?:/)?$"},{page:"/api/vendors/[id]",regex:"^/api/vendors/([^/]+?)(?:/)?$",routeKeys:{nxtPid:"nxtPid"},namedRegex:"^/api/vendors/(?<nxtPid>[^/]+?)(?:/)?$"},{page:"/bookings/confirmation/[id]",regex:"^/bookings/confirmation/([^/]+?)(?:/)?$",routeKeys:{nxtPid:"nxtPid"},namedRegex:"^/bookings/confirmation/(?<nxtPid>[^/]+?)(?:/)?$"},{page:"/bookings/payment/[id]",regex:"^/bookings/payment/([^/]+?)(?:/)?$",routeKeys:{nxtPid:"nxtPid"},namedRegex:"^/bookings/payment/(?<nxtPid>[^/]+?)(?:/)?$"},{page:"/destinations/[id]",regex:"^/destinations/([^/]+?)(?:/)?$",routeKeys:{nxtPid:"nxtPid"},namedRegex:"^/destinations/(?<nxtPid>[^/]+?)(?:/)?$"},{page:"/packages/[id]",regex:"^/packages/([^/]+?)(?:/)?$",routeKeys:{nxtPid:"nxtPid"},namedRegex:"^/packages/(?<nxtPid>[^/]+?)(?:/)?$"},{page:"/packages/[id]/book",regex:"^/packages/([^/]+?)/book(?:/)?$",routeKeys:{nxtPid:"nxtPid"},namedRegex:"^/packages/(?<nxtPid>[^/]+?)/book(?:/)?$"}],nextConfig:{basePath:""}})))(h,h,h);export{Yn as default};

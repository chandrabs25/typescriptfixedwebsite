var b={},V=(M,U,G)=>(b.__chunk_230=(A,f,a)=>{"use strict";a.d(f,{Po:()=>c,RA:()=>d}),a(9985);var n=a(6753);let c=()=>{let e=process.env.JWT_SECRET;return e?new TextEncoder().encode(e):(console.warn("WARNING: JWT_SECRET not set in environment variables. Using fallback secret for development only."),new TextEncoder().encode("fallback_secret_for_development_only"))};async function d(e){try{let i=e.cookies.get("auth_token")?.value;if(!i)return{isAuthenticated:!1,user:null};let{payload:r}=await n._(i,c()),t=Math.floor(Date.now()/1e3);return r.exp&&r.exp<t?{isAuthenticated:!1,user:null}:{isAuthenticated:!0,user:{id:r.sub,email:r.email,role:r.role}}}catch(i){return console.error("Error verifying auth token:",i),{isAuthenticated:!1,user:null}}}},b.__chunk_219=(A,f,a)=>{"use strict";a.d(f,{FP:()=>e,GW:()=>S,YS:()=>c,fy:()=>d,jq:()=>i,nx:()=>j,uv:()=>u});class n extends Error{constructor(l,h){super(l,h),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}n.code="ERR_JOSE_GENERIC";class c extends n{constructor(l,h,w="unspecified",g="unspecified"){super(l,{cause:{claim:w,reason:g,payload:h}}),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=w,this.reason=g,this.payload=h}}c.code="ERR_JWT_CLAIM_VALIDATION_FAILED";class d extends n{constructor(l,h,w="unspecified",g="unspecified"){super(l,{cause:{claim:w,reason:g,payload:h}}),this.code="ERR_JWT_EXPIRED",this.claim=w,this.reason=g,this.payload=h}}d.code="ERR_JWT_EXPIRED";class e extends n{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}}e.code="ERR_JOSE_ALG_NOT_ALLOWED";class i extends n{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}}i.code="ERR_JOSE_NOT_SUPPORTED";class r extends n{constructor(l="decryption operation failed",h){super(l,h),this.code="ERR_JWE_DECRYPTION_FAILED"}}r.code="ERR_JWE_DECRYPTION_FAILED";class t extends n{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}}t.code="ERR_JWE_INVALID";class S extends n{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}}S.code="ERR_JWS_INVALID";class u extends n{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}}u.code="ERR_JWT_INVALID";class y extends n{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}}y.code="ERR_JWK_INVALID";class s extends n{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}}s.code="ERR_JWKS_INVALID";class E extends n{constructor(l="no applicable key found in the JSON Web Key Set",h){super(l,h),this.code="ERR_JWKS_NO_MATCHING_KEY"}}E.code="ERR_JWKS_NO_MATCHING_KEY";class W extends n{constructor(l="multiple matching keys found in the JSON Web Key Set",h){super(l,h),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS"}}W.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";class O extends n{constructor(l="request timed out",h){super(l,h),this.code="ERR_JWKS_TIMEOUT"}}O.code="ERR_JWKS_TIMEOUT";class j extends n{constructor(l="signature verification failed",h){super(l,h),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}}j.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED"},b.__chunk_7269=(A,f,a)=>{"use strict";a.d(f,{Z:()=>n,b:()=>c});let n=crypto,c=d=>d instanceof CryptoKey},b.__chunk_8312=(A,f,a)=>{"use strict";a.d(f,{Z:()=>c});var n=a(219);function c(d,e){let i=`SHA-${d.slice(-3)}`;switch(d){case"HS256":case"HS384":case"HS512":return{hash:i,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:i,name:"RSA-PSS",saltLength:d.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:i,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:i,name:"ECDSA",namedCurve:e.namedCurve};case"Ed25519":return{name:"Ed25519"};case"EdDSA":return{name:e.name};default:throw new n.jq(`alg ${d} is not supported either by JOSE or your javascript runtime`)}}},b.__chunk_2967=(A,f,a)=>{"use strict";a.d(f,{Z:()=>d});var n=a(7269),c=a(219);let d=async e=>{if(!e.alg)throw TypeError('"alg" argument is required when "jwk.alg" is not present');let{algorithm:i,keyUsages:r}=function(u){let y,s;switch(u.kty){case"RSA":switch(u.alg){case"PS256":case"PS384":case"PS512":y={name:"RSA-PSS",hash:`SHA-${u.alg.slice(-3)}`},s=u.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":y={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${u.alg.slice(-3)}`},s=u.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":y={name:"RSA-OAEP",hash:`SHA-${parseInt(u.alg.slice(-3),10)||1}`},s=u.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new c.jq('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(u.alg){case"ES256":y={name:"ECDSA",namedCurve:"P-256"},s=u.d?["sign"]:["verify"];break;case"ES384":y={name:"ECDSA",namedCurve:"P-384"},s=u.d?["sign"]:["verify"];break;case"ES512":y={name:"ECDSA",namedCurve:"P-521"},s=u.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":y={name:"ECDH",namedCurve:u.crv},s=u.d?["deriveBits"]:[];break;default:throw new c.jq('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"OKP":switch(u.alg){case"Ed25519":y={name:"Ed25519"},s=u.d?["sign"]:["verify"];break;case"EdDSA":y={name:u.crv},s=u.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":y={name:u.crv},s=u.d?["deriveBits"]:[];break;default:throw new c.jq('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;default:throw new c.jq('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:y,keyUsages:s}}(e),t=[i,e.ext??!1,e.key_ops??r],S={...e};return delete S.alg,delete S.use,n.Z.subtle.importKey("jwk",S,...t)}},b.__chunk_6178=(A,f,a)=>{"use strict";a.d(f,{V:()=>d,Z:()=>c});var n=a(7269);let c=e=>!!(0,n.b)(e)||e?.[Symbol.toStringTag]==="KeyObject",d=["CryptoKey"]},b.__chunk_7511=(A,f,a)=>{"use strict";let n,c;a.d(f,{Z:()=>R});var d=a(7269);function e(l,h="algorithm.name"){return TypeError(`CryptoKey does not support this operation, its ${h} must be ${l}`)}function i(l,h){return l.name===h}function r(l){return parseInt(l.name.slice(4),10)}var t=a(3932),S=a(6178),u=a(7393),y=a(8713),s=a(2967);let E=l=>(0,y.Jx)(l),W=l=>l?.[Symbol.toStringTag]==="KeyObject",O=async(l,h,w,g,K=!1)=>{let H=l.get(h);if(H?.[g])return H[g];let v=await(0,s.Z)({...w,alg:g});return K&&Object.freeze(h),H?H[g]=v:l.set(h,{[g]:v}),v},j={normalizePublicKey:(l,h)=>{if(W(l)){let w=l.export({format:"jwk"});return delete w.d,delete w.dp,delete w.dq,delete w.p,delete w.q,delete w.qi,w.k?E(w.k):(c||(c=new WeakMap),O(c,l,w,h))}return(0,u.x)(l)?l.k?(0,y.Jx)(l.k):(c||(c=new WeakMap),O(c,l,l,h,!0)):l},normalizePrivateKey:(l,h)=>{if(W(l)){let w=l.export({format:"jwk"});return w.k?E(w.k):(n||(n=new WeakMap),O(n,l,w,h))}return(0,u.x)(l)?l.k?(0,y.Jx)(l.k):(n||(n=new WeakMap),O(n,l,l,h,!0)):l}};async function R(l,h,w){if(w==="sign"&&(h=await j.normalizePrivateKey(h,l)),w==="verify"&&(h=await j.normalizePublicKey(h,l)),(0,d.b)(h))return function(g,K,...H){switch(K){case"HS256":case"HS384":case"HS512":{if(!i(g.algorithm,"HMAC"))throw e("HMAC");let v=parseInt(K.slice(2),10);if(r(g.algorithm.hash)!==v)throw e(`SHA-${v}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!i(g.algorithm,"RSASSA-PKCS1-v1_5"))throw e("RSASSA-PKCS1-v1_5");let v=parseInt(K.slice(2),10);if(r(g.algorithm.hash)!==v)throw e(`SHA-${v}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!i(g.algorithm,"RSA-PSS"))throw e("RSA-PSS");let v=parseInt(K.slice(2),10);if(r(g.algorithm.hash)!==v)throw e(`SHA-${v}`,"algorithm.hash");break}case"EdDSA":if(g.algorithm.name!=="Ed25519"&&g.algorithm.name!=="Ed448")throw e("Ed25519 or Ed448");break;case"Ed25519":if(!i(g.algorithm,"Ed25519"))throw e("Ed25519");break;case"ES256":case"ES384":case"ES512":{if(!i(g.algorithm,"ECDSA"))throw e("ECDSA");let v=function(J){switch(J){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw Error("unreachable")}}(K);if(g.algorithm.namedCurve!==v)throw e(v,"algorithm.namedCurve");break}default:throw TypeError("CryptoKey does not support this operation")}(function(v,J){if(J.length&&!J.some(o=>v.usages.includes(o))){let o="CryptoKey does not support this operation, its usages must include ";if(J.length>2){let m=J.pop();o+=`one of ${J.join(", ")}, or ${m}.`}else J.length===2?o+=`one of ${J[0]} or ${J[1]}.`:o+=`${J[0]}.`;throw TypeError(o)}})(g,H)}(h,l,w),h;if(h instanceof Uint8Array){if(!l.startsWith("HS"))throw TypeError((0,t.Z)(h,...S.V));return d.Z.subtle.importKey("raw",h,{hash:`SHA-${l.slice(-3)}`,name:"HMAC"},!1,[w])}throw TypeError((0,t.Z)(h,...S.V,"Uint8Array","JSON Web Key"))}},b.__chunk_212=(A,f,a)=>{"use strict";a.d(f,{Z:()=>n});let n=(c,d)=>{if(c.startsWith("RS")||c.startsWith("PS")){let{modulusLength:e}=d.algorithm;if(typeof e!="number"||e<2048)throw TypeError(`${c} requires key modulusLength to be 2048 bits or larger`)}}},b.__chunk_8713=(A,f,a)=>{"use strict";a.d(f,{Jx:()=>i,cv:()=>d});var n=a(5763);let c=r=>{let t=r;typeof t=="string"&&(t=n.g7.encode(t));let S=[];for(let u=0;u<t.length;u+=32768)S.push(String.fromCharCode.apply(null,t.subarray(u,u+32768)));return btoa(S.join(""))},d=r=>c(r).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),e=r=>{let t=atob(r),S=new Uint8Array(t.length);for(let u=0;u<t.length;u++)S[u]=t.charCodeAt(u);return S},i=r=>{let t=r;t instanceof Uint8Array&&(t=n.xv.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return e(t)}catch{throw TypeError("The input to be decoded is not correctly encoded.")}}},b.__chunk_4181=(A,f,a)=>{"use strict";a.d(f,{Z:()=>c});var n=a(219);let c=function(d,e,i,r,t){let S;if(t.crit!==void 0&&r?.crit===void 0)throw new d('"crit" (Critical) Header Parameter MUST be integrity protected');if(!r||r.crit===void 0)return new Set;if(!Array.isArray(r.crit)||r.crit.length===0||r.crit.some(u=>typeof u!="string"||u.length===0))throw new d('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let u of(S=i!==void 0?new Map([...Object.entries(i),...e.entries()]):e,r.crit)){if(!S.has(u))throw new n.jq(`Extension Header Parameter "${u}" is not recognized`);if(t[u]===void 0)throw new d(`Extension Header Parameter "${u}" is missing`);if(S.get(u)&&r[u]===void 0)throw new d(`Extension Header Parameter "${u}" MUST be integrity protected`)}return new Set(r.crit)}},b.__chunk_7190=(A,f,a)=>{"use strict";a.d(f,{Z:()=>c});let n=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,c=d=>{let e,i=n.exec(d);if(!i||i[4]&&i[1])throw TypeError("Invalid time period format");let r=parseFloat(i[2]);switch(i[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":e=Math.round(r);break;case"minute":case"minutes":case"min":case"mins":case"m":e=Math.round(60*r);break;case"hour":case"hours":case"hr":case"hrs":case"h":e=Math.round(3600*r);break;case"day":case"days":case"d":e=Math.round(86400*r);break;case"week":case"weeks":case"w":e=Math.round(604800*r);break;default:e=Math.round(31557600*r)}return i[1]==="-"||i[4]==="ago"?-e:e}},b.__chunk_2265=(A,f,a)=>{"use strict";function n(c){if(!(typeof c=="object"&&c!==null)||Object.prototype.toString.call(c)!=="[object Object]")return!1;if(Object.getPrototypeOf(c)===null)return!0;let d=c;for(;Object.getPrototypeOf(d)!==null;)d=Object.getPrototypeOf(d);return Object.getPrototypeOf(c)===d}a.d(f,{Z:()=>n})},b.__chunk_7393=(A,f,a)=>{"use strict";a.d(f,{Ct:()=>i,US:()=>d,vv:()=>e,x:()=>c});var n=a(2265);function c(r){return(0,n.Z)(r)&&typeof r.kty=="string"}function d(r){return r.kty!=="oct"&&typeof r.d=="string"}function e(r){return r.kty!=="oct"&&r.d===void 0}function i(r){return c(r)&&r.kty==="oct"&&typeof r.k=="string"}},b.__chunk_8540=(A,f,a)=>{"use strict";a.d(f,{Z:()=>n});let n=(...c)=>{let d,e=c.filter(Boolean);if(e.length===0||e.length===1)return!0;for(let i of e){let r=Object.keys(i);if(!d||d.size===0){d=new Set(r);continue}for(let t of r){if(d.has(t))return!1;d.add(t)}}return!0}},b.__chunk_3932=(A,f,a)=>{"use strict";function n(e,i,...r){if((r=r.filter(Boolean)).length>2){let t=r.pop();e+=`one of type ${r.join(", ")}, or ${t}.`}else r.length===2?e+=`one of type ${r[0]} or ${r[1]}.`:e+=`of type ${r[0]}.`;return i==null?e+=` Received ${i}`:typeof i=="function"&&i.name?e+=` Received function ${i.name}`:typeof i=="object"&&i!=null&&i.constructor?.name&&(e+=` Received an instance of ${i.constructor.name}`),e}a.d(f,{J:()=>d,Z:()=>c});let c=(e,...i)=>n("Key must be ",e,...i);function d(e,i,...r){return n(`Key for the ${e} algorithm must be `,i,...r)}},b.__chunk_7391=(A,f,a)=>{"use strict";a.d(f,{Z:()=>n});let n=c=>Math.floor(c.getTime()/1e3)},b.__chunk_7442=(A,f,a)=>{"use strict";a.d(f,{Y:()=>u});var n=a(3932),c=a(6178),d=a(7393);let e=y=>y?.[Symbol.toStringTag],i=(y,s,E)=>{if(s.use!==void 0&&s.use!=="sig")throw TypeError("Invalid key for this operation, when present its use must be sig");if(s.key_ops!==void 0&&s.key_ops.includes?.(E)!==!0)throw TypeError(`Invalid key for this operation, when present its key_ops must include ${E}`);if(s.alg!==void 0&&s.alg!==y)throw TypeError(`Invalid key for this operation, when present its alg must be ${y}`);return!0},r=(y,s,E,W)=>{if(!(s instanceof Uint8Array)){if(W&&d.x(s)){if(d.Ct(s)&&i(y,s,E))return;throw TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!(0,c.Z)(s))throw TypeError((0,n.J)(y,s,...c.V,"Uint8Array",W?"JSON Web Key":null));if(s.type!=="secret")throw TypeError(`${e(s)} instances for symmetric algorithms must be of type "secret"`)}},t=(y,s,E,W)=>{if(W&&d.x(s))switch(E){case"sign":if(d.US(s)&&i(y,s,E))return;throw TypeError("JSON Web Key for this operation be a private JWK");case"verify":if(d.vv(s)&&i(y,s,E))return;throw TypeError("JSON Web Key for this operation be a public JWK")}if(!(0,c.Z)(s))throw TypeError((0,n.J)(y,s,...c.V,W?"JSON Web Key":null));if(s.type==="secret")throw TypeError(`${e(s)} instances for asymmetric algorithms must not be of type "secret"`);if(E==="sign"&&s.type==="public")throw TypeError(`${e(s)} instances for asymmetric algorithm signing must be of type "private"`);if(E==="decrypt"&&s.type==="public")throw TypeError(`${e(s)} instances for asymmetric algorithm decryption must be of type "private"`);if(s.algorithm&&E==="verify"&&s.type==="private")throw TypeError(`${e(s)} instances for asymmetric algorithm verifying must be of type "public"`);if(s.algorithm&&E==="encrypt"&&s.type==="private")throw TypeError(`${e(s)} instances for asymmetric algorithm encryption must be of type "public"`)};function S(y,s,E,W){s.startsWith("HS")||s==="dir"||s.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(s)?r(s,E,W,y):t(s,E,W,y)}S.bind(void 0,!1);let u=S.bind(void 0,!0)},b.__chunk_5763=(A,f,a)=>{"use strict";a.d(f,{g7:()=>n,xv:()=>c,zo:()=>d});let n=new TextEncoder,c=new TextDecoder;function d(...e){let i=new Uint8Array(e.reduce((t,{length:S})=>t+S,0)),r=0;for(let t of e)i.set(t,r),r+=t.length;return i}},b.__chunk_6753=(A,f,a)=>{"use strict";a.d(f,{_:()=>J});var n=a(8713),c=a(8312),d=a(7269),e=a(212),i=a(7511);let r=async(o,m,k,p)=>{let _=await(0,i.Z)(o,m,"verify");(0,e.Z)(o,_);let T=(0,c.Z)(o,_.algorithm);try{return await d.Z.subtle.verify(T,_,k,p)}catch{return!1}};var t=a(219),S=a(5763),u=a(8540),y=a(2265),s=a(7442),E=a(4181);let W=(o,m)=>{if(m!==void 0&&(!Array.isArray(m)||m.some(k=>typeof k!="string")))throw TypeError(`"${o}" option must be an array of strings`);if(m)return new Set(m)};var O=a(7393),j=a(2967);async function R(o,m){if(!(0,y.Z)(o))throw TypeError("JWK must be an object");switch(m||(m=o.alg),o.kty){case"oct":if(typeof o.k!="string"||!o.k)throw TypeError('missing "k" (Key Value) Parameter value');return(0,n.Jx)(o.k);case"RSA":if("oth"in o&&o.oth!==void 0)throw new t.jq('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return(0,j.Z)({...o,alg:m});default:throw new t.jq('Unsupported "kty" (Key Type) Parameter value')}}async function l(o,m,k){let p,_;if(!(0,y.Z)(o))throw new t.GW("Flattened JWS must be an object");if(o.protected===void 0&&o.header===void 0)throw new t.GW('Flattened JWS must have either of the "protected" or "header" members');if(o.protected!==void 0&&typeof o.protected!="string")throw new t.GW("JWS Protected Header incorrect type");if(o.payload===void 0)throw new t.GW("JWS Payload missing");if(typeof o.signature!="string")throw new t.GW("JWS Signature missing or incorrect type");if(o.header!==void 0&&!(0,y.Z)(o.header))throw new t.GW("JWS Unprotected Header incorrect type");let T={};if(o.protected)try{let $=(0,n.Jx)(o.protected);T=JSON.parse(S.xv.decode($))}catch{throw new t.GW("JWS Protected Header is invalid")}if(!(0,u.Z)(T,o.header))throw new t.GW("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let L={...T,...o.header},I=(0,E.Z)(t.GW,new Map([["b64",!0]]),k?.crit,T,L),x=!0;if(I.has("b64")&&typeof(x=T.b64)!="boolean")throw new t.GW('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:P}=L;if(typeof P!="string"||!P)throw new t.GW('JWS "alg" (Algorithm) Header Parameter missing or invalid');let C=k&&W("algorithms",k.algorithms);if(C&&!C.has(P))throw new t.FP('"alg" (Algorithm) Header Parameter value not allowed');if(x){if(typeof o.payload!="string")throw new t.GW("JWS Payload must be a string")}else if(typeof o.payload!="string"&&!(o.payload instanceof Uint8Array))throw new t.GW("JWS Payload must be a string or an Uint8Array instance");let D=!1;typeof m=="function"?(m=await m(T,o),D=!0,(0,s.Y)(P,m,"verify"),(0,O.x)(m)&&(m=await R(m,P))):(0,s.Y)(P,m,"verify");let Z=(0,S.zo)(S.g7.encode(o.protected??""),S.g7.encode("."),typeof o.payload=="string"?S.g7.encode(o.payload):o.payload);try{p=(0,n.Jx)(o.signature)}catch{throw new t.GW("Failed to base64url decode the signature")}if(!await r(P,m,p,Z))throw new t.nx;if(x)try{_=(0,n.Jx)(o.payload)}catch{throw new t.GW("Failed to base64url decode the payload")}else _=typeof o.payload=="string"?S.g7.encode(o.payload):o.payload;let N={payload:_};return o.protected!==void 0&&(N.protectedHeader=T),o.header!==void 0&&(N.unprotectedHeader=o.header),D?{...N,key:m}:N}async function h(o,m,k){if(o instanceof Uint8Array&&(o=S.xv.decode(o)),typeof o!="string")throw new t.GW("Compact JWS must be a string or Uint8Array");let{0:p,1:_,2:T,length:L}=o.split(".");if(L!==3)throw new t.GW("Invalid Compact JWS");let I=await l({payload:_,protected:p,signature:T},m,k),x={payload:I.payload,protectedHeader:I.protectedHeader};return typeof m=="function"?{...x,key:I.key}:x}var w=a(7391),g=a(7190);let K=o=>o.toLowerCase().replace(/^application\//,""),H=(o,m)=>typeof o=="string"?m.includes(o):!!Array.isArray(o)&&m.some(Set.prototype.has.bind(new Set(o))),v=(o,m,k={})=>{let p,_;try{p=JSON.parse(S.xv.decode(m))}catch{}if(!(0,y.Z)(p))throw new t.uv("JWT Claims Set must be a top-level JSON object");let{typ:T}=k;if(T&&(typeof o.typ!="string"||K(o.typ)!==K(T)))throw new t.YS('unexpected "typ" JWT header value',p,"typ","check_failed");let{requiredClaims:L=[],issuer:I,subject:x,audience:P,maxTokenAge:C}=k,D=[...L];for(let $ of(C!==void 0&&D.push("iat"),P!==void 0&&D.push("aud"),x!==void 0&&D.push("sub"),I!==void 0&&D.push("iss"),new Set(D.reverse())))if(!($ in p))throw new t.YS(`missing required "${$}" claim`,p,$,"missing");if(I&&!(Array.isArray(I)?I:[I]).includes(p.iss))throw new t.YS('unexpected "iss" claim value',p,"iss","check_failed");if(x&&p.sub!==x)throw new t.YS('unexpected "sub" claim value',p,"sub","check_failed");if(P&&!H(p.aud,typeof P=="string"?[P]:P))throw new t.YS('unexpected "aud" claim value',p,"aud","check_failed");switch(typeof k.clockTolerance){case"string":_=(0,g.Z)(k.clockTolerance);break;case"number":_=k.clockTolerance;break;case"undefined":_=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:Z}=k,N=(0,w.Z)(Z||new Date);if((p.iat!==void 0||C)&&typeof p.iat!="number")throw new t.YS('"iat" claim must be a number',p,"iat","invalid");if(p.nbf!==void 0){if(typeof p.nbf!="number")throw new t.YS('"nbf" claim must be a number',p,"nbf","invalid");if(p.nbf>N+_)throw new t.YS('"nbf" claim timestamp check failed',p,"nbf","check_failed")}if(p.exp!==void 0){if(typeof p.exp!="number")throw new t.YS('"exp" claim must be a number',p,"exp","invalid");if(p.exp<=N-_)throw new t.fy('"exp" claim timestamp check failed',p,"exp","check_failed")}if(C){let $=N-p.iat;if($-_>(typeof C=="number"?C:(0,g.Z)(C)))throw new t.fy('"iat" claim timestamp check failed (too far in the past)',p,"iat","check_failed");if($<0-_)throw new t.YS('"iat" claim timestamp check failed (it should be in the past)',p,"iat","check_failed")}return p};async function J(o,m,k){let p=await h(o,m,k);if(p.protectedHeader.crit?.includes("b64")&&p.protectedHeader.b64===!1)throw new t.uv("JWTs MUST NOT use unencoded payload");let _={payload:v(p.protectedHeader,p.payload,k),protectedHeader:p.protectedHeader};return typeof m=="function"?{..._,key:p.key}:_}},b);export{V as __getNamedExports};
